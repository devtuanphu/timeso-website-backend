import{j as e,Z as D,g as W,T as f,dk as U,I as H,o as v,bD as K,V as $,h as B,dL as q,dM as J,$ as Z,dN as X,C as ee,q as te,ak as se,a$ as ne,a as R,p as ae,aE as x,a3 as ie,aB as re,r as b,dO as oe,dP as le,dQ as ce,aR as _,dR as de,dS as ue,u as pe,dT as ge,dU as he,bk as fe,dV as h,bo as w,n as me,c as ye,aJ as xe,dW as je,aN as Te,P as I,aO as N,L as Le,dX as be,dY as M}from"./strapi-DK5aFXRl.js";import{u as Ce}from"./useDragLayer-D3FNSgQv.js";import{C as Se}from"./CardDragPreview-CQ61Zhn3.js";import{a as Me,u as A}from"./hooks-B9W15WSZ.js";function ke(s,n,r){if(!s||!n||!r)return{display:"none"};const{x:t,y:o}=r;return{transform:`translate(${t}px, ${o}px)`}}const Ie=({renderItem:s})=>{const{itemType:n,isDragging:r,item:t,initialOffset:o,currentOffset:u,mouseOffset:p}=Ce(i=>({item:i.getItem(),itemType:i.getItemType(),initialOffset:i.getInitialSourceClientOffset(),currentOffset:i.getSourceClientOffset(),isDragging:i.isDragging(),mouseOffset:i.getClientOffset()}));return r?e.jsx(D,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:e.jsx(D,{style:ke(o,u,p),children:s({type:n,item:t})})}):null},De=({displayedValue:s})=>{const n=W();return e.jsxs(f,{background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:3,padding:3,width:"30rem",children:[e.jsx(Pe,{type:"button",children:e.jsxs(f,{gap:6,children:[e.jsx(Ee,{alignItems:"center",justifyContent:"center",background:"neutral200",height:"3.2rem",width:"3.2rem",children:e.jsx(U,{})}),e.jsx(f,{maxWidth:"15rem",children:e.jsx(H,{textColor:"neutral700",ellipsis:!0,children:s})})]})}),e.jsxs(f,{gap:2,children:[e.jsx(v,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(K,{})}),n&&e.jsx(v,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx($,{})})]})]})},Ee=B(f)`
  border-radius: 50%;

  svg {
    height: 0.6rem;
    width: 1.1rem;
    > path {
      fill: ${({theme:s})=>s.colors.neutral600};
    }
  }
`,Pe=B.button`
  border: none;
  background: transparent;
  display: block;
  width: 100%;
  text-align: unset;
  padding: 0;
`,Oe=({status:s,displayedValue:n,width:r})=>{const t=W();return e.jsx(D,{style:{width:r},children:e.jsxs(f,{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:4,hasRadius:!0,borderWidth:1,background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:4,children:[e.jsxs(q,{gap:1,children:[t&&e.jsx(v,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx($,{})}),e.jsxs(f,{width:"100%",minWidth:0,justifyContent:"space-between",children:[e.jsx(D,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:e.jsx(J,{href:"",children:e.jsx(H,{textColor:"primary600",ellipsis:!0,children:n})})}),s?e.jsx(Z,{status:s}):null]})]}),e.jsx(X,{type:"button",children:e.jsx(ee,{width:"12px"})})]})})},{MUTATE_COLLECTION_TYPES_LINKS:we,MUTATE_SINGLE_TYPES_LINKS:Ne}=le,Q=()=>{const{toggleNotification:s}=te(),n=Me(),r=se("useContentManagerInitData",g=>g.runHookWaterfall),{notifyStatus:t}=ne(),{formatMessage:o}=R(),{_unstableFormatAPIError:u}=ae(x),p=ie("useContentManagerInitData",g=>g.checkUserHasPermissions),i=A(g=>g["content-manager"].app),a=re(void 0,{refetchOnMountOrArgChange:!0});b.useEffect(()=>{a.data&&t(o({id:x("App.schemas.data-loaded"),defaultMessage:"The schemas have been successfully loaded."}))},[o,a.data,t]),b.useEffect(()=>{a.error&&s({type:"danger",message:u(a.error)})},[u,a.error,s]);const d=oe();b.useEffect(()=>{d.error&&s({type:"danger",message:u(d.error)})},[u,d.error,s]);const m=async(g,T,E,P)=>{const{collectionType:j,singleType:O}=T.reduce((y,L)=>(y[L.kind].push(L),y),{collectionType:[],singleType:[]}),l=z(j,"collectionTypes",P),c=z(O,"singleTypes"),C=await Promise.all(l.map(({permissions:y})=>p(y))),S=l.filter((y,L)=>C[L].length>0),k=await Promise.all(c.map(({permissions:y})=>p(y))),V=c.filter((y,L)=>k[L].length>0),{ctLinks:Y}=r(we,{ctLinks:S,models:T}),{stLinks:G}=r(Ne,{stLinks:V,models:T});n(ce({authorizedCollectionTypeLinks:Y,authorizedSingleTypeLinks:G,components:g,contentTypeSchemas:T,fieldSizes:E}))};return b.useEffect(()=>{a.data&&d.data&&m(a.data.components,a.data.contentTypes,a.data.fieldSizes,d.data)},[a.data,d.data]),{...i}},z=(s,n,r=[])=>s.filter(t=>t.isDisplayed).map(t=>{const o=[{action:"plugin::content-manager.explorer.create",subject:t.uid},{action:"plugin::content-manager.explorer.read",subject:t.uid}],u=[{action:"plugin::content-manager.explorer.read",subject:t.uid}],p=n==="collectionTypes"?o:u,i=r.find(({uid:d})=>d===t.uid);let a=null;if(i){const d={page:1,pageSize:i.settings.pageSize,sort:`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`};a=_.stringify(d,{encode:!1})}return{permissions:p,search:a,kind:t.kind,title:t.info.displayName,to:`/content-manager/${t.kind==="collectionType"?de:ue}/${t.uid}`,uid:t.uid,name:t.uid,isDisplayed:t.isDisplayed}}),F=({isFullPage:s=!1})=>{const[n,r]=b.useState(""),[{query:t}]=pe(),{formatMessage:o,locale:u}=R(),{isLoading:p}=Q(),i=A(l=>l["content-manager"].app.collectionTypeLinks),a=A(l=>l["content-manager"].app.singleTypeLinks),{schemas:d}=ge(),{contains:m}=he(u,{sensitivity:"base"}),g=fe(u,{sensitivity:"base"}),T=b.useMemo(()=>[{id:"collectionTypes",title:o({id:x("components.LeftMenu.collection-types"),defaultMessage:"Collection Types"}),searchable:!0,links:i},{id:"singleTypes",title:o({id:x("components.LeftMenu.single-types"),defaultMessage:"Single Types"}),searchable:!0,links:a}].map(l=>({...l,links:l.links.filter(c=>m(c.title,n.trim())).sort((c,C)=>g.compare(c.title,C.title)).map(c=>({...c,title:o({id:c.title,defaultMessage:c.title})}))})),[i,n,a,m,o,g]),E=()=>{r("")},P=l=>{r(l.target.value)},j=o({id:x("header.name"),defaultMessage:"Content Manager"}),O=l=>{const C=!!d.find(S=>S.uid===l.uid)?.pluginOptions?.i18n?.localized;if(t.plugins&&"i18n"in t.plugins){const{i18n:S,...k}=t.plugins;return C?{i18n:S,...k}:k}return t.plugins};return p?e.jsxs(h.Main,{"aria-label":j,children:[e.jsx(h.Header,{label:j}),e.jsx(w,{}),e.jsx(f,{padding:4,justifyContent:"center",children:e.jsx(me,{})})]}):e.jsxs(h.Main,{"aria-label":j,children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx(h.Header,{label:j}),e.jsx(w,{})]}),e.jsxs(h.Content,{children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(h.Header,{label:j}),e.jsx(w,{})]}),e.jsx(f,{paddingLeft:{initial:3,large:5},paddingRight:{initial:3,large:5},paddingTop:5,paddingBottom:{initial:1,large:0},gap:3,direction:"column",alignItems:"stretch",children:e.jsx(ye,{value:n,onChange:P,onClear:E,placeholder:o({id:"search.placeholder",defaultMessage:"Search"}),size:"S",children:void 0,name:"search_contentType",clearLabel:o({id:"clearLabel",defaultMessage:"Clear"})})}),e.jsx(h.Sections,{children:T.map(l=>e.jsx(h.Section,{label:l.title,badgeLabel:l.links.length.toString(),children:l.links.map(c=>e.jsx(h.Link,{to:{pathname:c.to,search:_.stringify({..._.parse(c.search??""),plugins:O(c)})},label:c.title},c.uid))},l.id))})]})]})},Fe=()=>{const s=xe("/content-manager/:kind/:uid/*"),n=je(),{isLoading:r,collectionTypeLinks:t,models:o,singleTypeLinks:u}=Q(),p=[...t,...u].sort((m,g)=>m.title.localeCompare(g.title)),{pathname:i}=Te(),{formatMessage:a}=R();if(r)return e.jsxs(e.Fragment,{children:[e.jsx(I.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(I.Loading,{})]});const d=o.filter(({isDisplayed:m})=>m);return p.length===0&&d.length>0&&i!=="/content-manager/403"?e.jsx(N,{to:"/403"}):d.length===0&&i!=="/no-content-types"?e.jsx(N,{to:"/no-content-types"}):!s&&p.length>0?n?e.jsxs(e.Fragment,{children:[e.jsx(I.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(h.PageWrapper,{children:e.jsx(F,{isFullPage:!0})})]}):e.jsx(N,{to:{pathname:p[0].to,search:p[0].search??""},replace:!0}):e.jsxs(e.Fragment,{children:[e.jsx(I.Title,{children:a({id:x("plugin.name"),defaultMessage:"Content Manager"})}),e.jsxs(Le.Root,{sideNav:e.jsx(F,{}),children:[e.jsx(Ie,{renderItem:ve}),e.jsx(be,{})]})]})};function ve({type:s,item:n}){if(!s||s&&typeof s!="string")return null;const[r]=s.split("_");switch(r){case M.EDIT_FIELD:case M.FIELD:return e.jsx(Se,{label:n.label});case M.COMPONENT:case M.DYNAMIC_ZONE:return e.jsx(De,{displayedValue:n.displayedValue});case M.RELATION:return e.jsx(Oe,{...n});default:return null}}export{Fe as Layout};
